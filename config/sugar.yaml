# Sugar Configuration
sugar:
  # Core Loop Settings
  loop_interval: 300  # 5 minutes between cycles
  max_concurrent_work: 3  # Execute multiple tasks per cycle
  dry_run: false  # Use real Claude Code CLI
  
  # Claude Code Integration
  claude:
    command: "/Users/steve/.claude/local/claude"  # Full path to Claude CLI
    timeout: 1800  # 30 minutes max per task
    context_file: "sugar_context.json"

    # MCP Server Configuration (optional)
    # Enables browser automation, filesystem access, and other MCP tools
    # mcp_servers:
    #   playwright:
    #     command: npx
    #     args: ["-y", "@anthropic/mcp-server-playwright"]
    #   filesystem:
    #     command: npx
    #     args: ["-y", "@anthropic/mcp-server-filesystem"]

    # Structured Claude Agent Integration System (Complete Implementation)
    use_structured_requests: true  # Enable structured JSON communication
    structured_input_file: ".sugar/claude_input.json"  # Temp file for complex inputs
    
    # Agent Selection & Discovery System
    enable_agents: true        # Enable Claude agent mode selection
    agent_fallback: true       # Fall back to basic Claude if agent fails
    agent_selection:           # Map work types to specific agents
      bug_fix: "tech-lead"           # Strategic analysis for bug fixes
      feature: "general-purpose"     # General development for features
      refactor: "code-reviewer"      # Code review expertise for refactoring
      test: "general-purpose"        # General development for tests
      documentation: "general-purpose"  # General development for docs
    
    # Dynamic Agent Discovery (supports any agents you have configured locally)
    # available_agents: []       # Optional: specify which agents are available
    
    # Context Persistence Settings
    use_continuous: true              # Enable --continue flag support
    context_strategy: "project"       # project|task_type|session
    max_context_age_hours: 24         # Hours before starting fresh session
    context_sharing: "same_type"      # same_type|all|none
    
  # Work Discovery
  discovery:
    # Global exclusions for all discovery modules
    global_excluded_dirs: [
      "node_modules", ".git", "__pycache__", 
      "venv", ".venv", "env", ".env", "ENV", 
      "env.bak", "venv.bak", "virtualenv",
      "build", "dist", ".tox", ".nox",
      "coverage", "htmlcov", ".pytest_cache",
      ".sugar", ".claude"
    ]
    
    error_logs:
      enabled: true
      paths:
        - "../logs/errors/"
        - "../logs/feedback/"
      patterns:
        - "*.json"
        - "*.log"
      max_age_hours: 24
    
    github:
      enabled: false  # Set to true and configure to enable
      repo: ""  # e.g., "user/repository"
      
      # Authentication method: "token", "gh_cli", or "auto"
      auth_method: "auto"  # Try gh CLI first, fallback to token
      
      # GitHub Personal Access Token (if using "token" method)
      token: ""  # Or set GITHUB_TOKEN environment variable
      
      # GitHub CLI integration (if using "gh_cli" method)  
      gh_cli:
        command: "gh"  # Path to gh command
        use_default_auth: true  # Use gh CLI's existing authentication
        
      # Discovery settings
      issue_labels: ["bug", "enhancement", "good-first-issue"]
      check_interval_minutes: 30
      
      # Workflow settings for completed work
      workflow:
        # Auto-close issues after successful completion
        auto_close_issues: true
        
        # Git workflow: "direct_commit" or "pull_request"
        git_workflow: "direct_commit"  # direct_commit|pull_request
        
        # Branch settings (used when git_workflow: "pull_request")
        branch:
          # Auto-create feature branches for each issue
          create_branches: true
          # Branch naming pattern (variables: {issue_number}, {issue_title_slug})
          name_pattern: "sugar/issue-{issue_number}"
          # Base branch for new branches and PRs
          base_branch: "main"
          
        # Pull request settings (used when git_workflow: "pull_request")
        pull_request:
          # Auto-create PRs after completing work
          auto_create: true
          # Auto-merge PRs (only if all checks pass)
          auto_merge: false
          # PR title pattern (variables: same as branch naming)
          title_pattern: "Fix #{issue_number}: {issue_title}"
          # Include work summary in PR description
          include_work_summary: true
          
        # Commit settings
        commit:
          # Include issue reference in commit messages
          include_issue_ref: true
          # Commit message pattern (variables: {issue_number}, {work_summary})
          message_pattern: "Fix #{issue_number}: {work_summary}"
          # Auto-commit changes after completing work
          auto_commit: true
      
    code_quality:
      enabled: true
      root_path: ".."  # Path to analyze
      file_extensions: [".py", ".js", ".ts", ".jsx", ".tsx"]
      excluded_dirs: [
        "node_modules", ".git", "__pycache__", 
        "venv", ".venv", "env", ".env", "ENV", 
        "env.bak", "venv.bak", "virtualenv",
        "build", "dist", ".tox", ".nox",
        "coverage", "htmlcov", ".pytest_cache",
        ".sugar", ".claude"
      ]
      max_files_per_scan: 50
      
    test_coverage:
      enabled: true
      root_path: ".."  # Path to analyze
      source_dirs: ["src", "lib", "app", "system", "sugar"]
      test_dirs: ["tests", "test", "__tests__", "spec"]
      excluded_dirs: [
        "node_modules", ".git", "__pycache__", 
        "venv", ".venv", "env", ".env", "ENV", 
        "env.bak", "venv.bak", "virtualenv",
        "build", "dist", ".tox", ".nox",
        "coverage", "htmlcov", ".pytest_cache",
        ".sugar", ".claude"
      ]
      
  # Storage
  storage:
    database: "sugar.db"
    backup_interval: 3600  # 1 hour
    
  # Safety
  safety:
    max_retries: 3
    excluded_paths:
      - "/System"
      - "/usr/bin"
      - "/etc"
    
  # Logging
  logging:
    level: "INFO"
    file: ".sugar/sugar.log"

  # Ralph Wiggum Integration
  # -----------------------------------------------------------------
  # Ralph Wiggum is an iterative AI loop technique. Instead of trying
  # to complete a task in one shot (and often failing on complex tasks),
  # Ralph feeds the SAME prompt repeatedly. Each iteration, Claude sees
  # its previous work in the files and iteratively improves until done.
  #
  # Think of it like this: instead of asking a junior dev to write a
  # feature perfectly the first time, you let them iterate. They write
  # something, see what's wrong, fix it, repeat until it works.
  #
  # This makes Sugar WAY more effective at complex tasks because:
  # 1. It can self-correct mistakes
  # 2. It builds incrementally instead of trying to do everything at once
  # 3. It runs tests between iterations and fixes failures
  # 4. It stops automatically when the task is actually complete
  # -----------------------------------------------------------------
  ralph:
    enabled: true

    # Safety: max iterations before giving up (prevents infinite loops)
    max_iterations: 10
    iteration_timeout: 300  # 5 min per iteration

    # How Claude signals "I'm done" - looks for <promise>DONE</promise>
    default_promise: "DONE"

    # IMPORTANT: Require explicit completion criteria in prompts
    # Without this, Ralph could loop forever!
    require_completion_criteria: true

    # Run quality gates (tests, linting) between iterations
    quality_gates_enabled: true
    stop_on_gate_failure: false  # Keep trying even if tests fail

    # Confidence threshold for completion
    min_confidence: 0.8

    # Task types that automatically use Ralph (empty = opt-in only)
    # Example: ["complex_bug", "refactor", "tdd"]
    iterative_task_types: []